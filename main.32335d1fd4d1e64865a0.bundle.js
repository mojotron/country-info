(()=>{"use strict";const e="https://restcountries.com/v3.1/",t="search-result",a={countries:[],country:{}},r=async e=>{try{const t=await fetch(e);if(!t.ok)throw new Error("Network error, please try again!");return await t.json()}catch(e){throw console.error(e.message),e}};(async e=>{try{const t=await r(e);a.countries=await t.map((e=>{const{flags:{png:t},name:{common:a},cca3:r}=e;return{name:a,flag:t,code:r}})),a.countries.sort(((e,t)=>e.name>t.name))}catch(e){console.error(e)}})(e+"all?fields=flags,name,cca3");const n=new class{#e=document.querySelector(".header__search");#t=document.querySelector("#search");addHandlerInput(e){this.#t.addEventListener("input",(t=>{e(t.target.value)}))}clearInput(){this.#t.value=""}addHandlerSubmit(e){this.#e.addEventListener("submit",(t=>{t.preventDefault();const a=document.querySelector(".search-result");a&&(this.clearInput(),e(a.dataset.countryCode))}))}};const o=new class{#e=document.querySelector(".search-match");matchResults(e){this.clearResults(),e.forEach((e=>{this.#e.append(this.#a(e))}))}addMatchClickHandler(e){this.#e.addEventListener("click",(t=>{const a=t.target.closest(".search-result");e(a.dataset.countryCode)}))}#a(e){const a=document.createElement("p");return a.className=t,a.textContent=e.name,a.dataset.countryCode=e.code,a}clearResults(){this.#e.innerHTML=""}};const s=new class{#e=document.querySelector(".countries");#r=document.querySelector("[data-card-template]");#n;#o;render(e,t){this.#n=e,this.#o=t;const a=this.#s();this.#e.innerHTML="",this.#e.append(a),this.#c(e)}renderError(e){const t=document.createElement("div");t.className="error",t.textContent=e,this.#e.append(t)}#s(){const e=this.#r.content.cloneNode(!0).children[0];if(e.querySelector("[data-name]").textContent=this.#n.name,e.querySelector("[data-population]").textContent=`${this.#l()}`,e.querySelector("[data-region]").textContent=this.#n.region,e.querySelector("[data-capital]").textContent=this.#n.capital??"âˆ…",this.#n.borders){const t=e.querySelector("[data-borders]");this.#d().forEach((e=>{t.append(e)}))}return e.querySelector("[data-flag]").style.setProperty("background-image",`url(${this.#n.flag})`),e}#l(){return this.#n.population>1e9?`${(this.#n.population/1e9).toFixed(1)}B`:this.#n.population>1e6?`${(this.#n.population/1e6).toFixed(1)}M`:this.#n.population}#d(){return this.#n.borders.map((e=>{const t=document.createElement("div");t.className="border-country";const a=this.#o.find((t=>t.code===e));return t.style.setProperty("background-image",`url(${a.flag})`),t.dataset.countryCode=a.code.toLowerCase(),t}))}#c(e){const t=L.icon({iconSize:[38,95],iconAnchor:[22,94],popupAnchor:[-3,-76],html:""}),a=L.map("map").setView(this.#n.coords,5);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),L.marker(this.#n.coords,{draggable:!0,icon:L.divIcon(t)}).addTo(a).bindPopup(`${e.name}`).openPopup()}addBorderClickHandler(e){this.#e.addEventListener("click",(t=>{const a=t.target.closest(".border-country");a&&e(a.dataset.countryCode)}))}},c=async t=>{try{await(async t=>{try{const[n]=await r(e+"alpha/"+t);a.country={name:n.name.common,flag:n.flags.png,population:n.population,region:n.region,coords:n.latlng,...n.borders&&{borders:n.borders},...n.capital&&{capital:n.capital[0]}}}catch(e){throw e}})(t),s.render(a.country,a.countries)}catch(e){console.log(e),s.renderError(e.message)}n.clearInput()},l=e=>{const t=a.countries.filter((t=>t.name.toLowerCase().startsWith(e.toLowerCase())));o.matchResults(t)},d=e=>{o.clearResults(),c(e)},i=e=>{c(e)};n.addHandlerInput(l),n.addHandlerSubmit(d),o.addMatchClickHandler(d),s.addBorderClickHandler(i)})();